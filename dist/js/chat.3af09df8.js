(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chat"],{"4e94":function(t,e,o){"use strict";var s=o("cbcd"),n=o.n(s);n.a},6911:function(t,e,o){t.exports=o.p+"img/4.52d78c21.png"},cbcd:function(t,e,o){},ee79:function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"content",staticClass:"box home-wrapper"},[s("van-nav-bar",{staticClass:"navbar",attrs:{border:!1,title:"客服","left-arrow":""},on:{"click-left":t.onClickLeft,"click-right":t.onClickRight},scopedSlots:t._u([{key:"right",fn:function(){return[s("van-icon",{attrs:{name:"service-o"}})]},proxy:!0}])}),t.type?s("div",[s("ul",{staticClass:"chatBox"},t._l(t.chatList,(function(e,n){return s("li",{key:n,class:["send_msg"==e.type?"user":"service"]},["send_msg"!==e.type?[s("img",{staticClass:"portrait",attrs:{src:o("6911"),alt:""}}),s("div",{staticClass:"service-content contentBox"},[s("p",{staticClass:"urseName"},[t._v("客服")]),s("div",{staticClass:"content"},[t._v(" "+t._s(e.content)+" ")])])]:[s("img",{staticClass:"portrait",attrs:{src:o("6911"),alt:""}}),s("div",{staticClass:"user-content contentBox"},[s("p",[t._v(t._s(t.username))]),s("div",{staticClass:"content"},[t._v(" "+t._s(e.content)+" ")])])]],2)})),0),s("div",{staticClass:"inpBox"},[s("div",{staticClass:"inp"},[s("van-field",{staticClass:"asd",model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1),s("button",{on:{click:t.sendBtn}},[t._v("发送")])])]):s("div",{staticClass:"choose"},[s("div",[s("p",[t._v("请选择咨询类型")]),s("button",{on:{click:function(e){t.type=1}}},[t._v("互帮类")]),s("button",{on:{click:function(e){t.type=2}}},[t._v("市场类")]),s("button",{on:{click:function(e){t.type=3}}},[t._v("电销类")])])])],1)},n=[],i={data:function(){return{levelList:null,adminIds:"",tokens:"",merIds:"",webSocket:null,lockReconnect:!1,timeout:28e3,timeoutObj:null,serverTimeoutObj:null,timeoutnum:null,apiUrl:this.$store.state.apiDomain,type:0,chatList:[],text:"",toast1:null,websock:null,uid:sessionStorage.getItem("user_id"),username:sessionStorage.getItem("name"),mobile:sessionStorage.getItem("mobile")}},watch:{chatList:{handler:function(t){setTimeout((function(){window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}),150)},deep:!0},type:{handler:function(){this.toast1=this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0}),this.initWebSocket()},deep:!0}},mounted:function(){setTimeout((function(){document.body.scrollHeight>document.documentElement.clientHeight-55&&window.scrollTo({top:document.body.scrollHeight})}),100)},methods:{sendBtn:function(){if(this.text)if(this.type){var t={type:"send_msg",uid:this.uid,content:this.text};this.text="",this.chatList.push(t),this.websock.send(t)}else this.$toast("请选择需要咨询的类型");else this.$toast("发送内容不能为空")},onClickLeft:function(){this.$router.go(-1)},onClickRight:function(){this.type&&this.$router.push({name:"history",params:{type_id:this.type}})},initWebSocket:function(){var t="ws://192.168.1.2:8181";this.websock=new WebSocket(t),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose},reconnect:function(){var t=this;t.lockReconnect||(t.lockReconnect=!0,t.timeoutnum&&clearTimeout(t.timeoutnum),t.timeoutnum=setTimeout((function(){t.initWebSocket(),t.lockReconnect=!1}),5e3))},websocketonopen:function(){this.toast1.clear();var t={type:"user_login",uid:this.uid,content:this.text,type_id:this.type,username:this.username,mobile:this.mobile};console.log("type:","user_login"),console.log("uid:",this.uid),console.log("content:",this.text),console.log("type_id:",this.type),console.log("username:",this.username),console.log("mobile:",this.mobile),this.websock.send(JSON.stringify(t)),console.log("WebSocket连接成功"),this.start()},websocketonerror:function(t){console.log("WebSocket连接发生错误",t),this.$toast("连接错误"),this.reconnect()},websocketclose:function(t){console.log("WebSocket关闭"),this.reconnect()},websockOpen:function(){console.log("WebSocket连接成功"),this.start()},websocketonmessage:function(t){console.log(JSON.parse(t.data),"接收");var e=JSON.parse(t.data),o=e.status,s=e.data;1==o?(this.chatList.push(s),this.reset()):this.$toast("当前无客服在线，请稍后重试")},start:function(){var t=this,e=3;t.timeoutObj&&clearTimeout(t.timeoutObj),t.serverTimeoutObj&&clearTimeout(t.serverTimeoutObj),t.timeoutObj=setTimeout((function(){1===t.websock.readyState?t.websock.send("heartCheck"):t.reconnect(),t.serverTimeoutObj=setTimeout((function(){e--,0===e&&t.websocketclose()}),t.timeout)}),t.timeout)},reset:function(){var t=this;clearTimeout(t.timeoutObj),clearTimeout(t.serverTimeoutObj),t.start()}},destroyed:function(){this.websocketclose()}},c=i,a=(o("4e94"),o("2877")),l=Object(a["a"])(c,s,n,!1,null,null,null);e["default"]=l.exports}}]);